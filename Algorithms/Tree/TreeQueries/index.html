



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Solutions to Competitive Programming Problems">
      
      
        <link rel="canonical" href="https://icpc.ninja/Algorithms/Tree/TreeQueries/">
      
      
        <meta name="author" content="JCHRYS">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>TreeQueries - ICPC.NINJA</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../css/katex.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-144755317-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#tree_queries" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://icpc.ninja" title="ICPC.NINJA" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              ICPC.NINJA
            </span>
            <span class="md-header-nav__topic">
              
                TreeQueries
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/jchrys/icpc/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    jchrys/icpc
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://icpc.ninja" title="ICPC.NINJA" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    ICPC.NINJA
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/jchrys/icpc/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    jchrys/icpc
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Algorithms
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Algorithms
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Graph
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Graph
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/Basics/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/GraphTraversal/" title="Graph Traversal" class="md-nav__link">
      Graph Traversal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/DirectedGraphs/" title="Directed Graphs" class="md-nav__link">
      Directed Graphs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/StrongConnectivity/" title="Strong Connectivity" class="md-nav__link">
      Strong Connectivity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-5" type="checkbox" id="nav-2-1-5">
    
    <label class="md-nav__link" for="nav-2-1-5">
      Shortest Paths
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-5">
        Shortest Paths
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/ShortestPaths/Preface/" title="Preface" class="md-nav__link">
      Preface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/ShortestPaths/Bellman-Ford/" title="Bellman-Ford" class="md-nav__link">
      Bellman-Ford
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/ShortestPaths/Dijkstra/" title="Dijkstra" class="md-nav__link">
      Dijkstra
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/ShortestPaths/Floyd-Warshall/" title="Floyd-Warshall" class="md-nav__link">
      Floyd-Warshall
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/EulerianPaths/" title="Eulerian Paths" class="md-nav__link">
      Eulerian Paths
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/HamiltonianPaths/" title="Hamiltonian Paths" class="md-nav__link">
      Hamiltonian Paths
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/DeBruijnSequences/" title="De Bruijn sequences" class="md-nav__link">
      De Bruijn sequences
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/KnightsTours/" title="Knight's tours" class="md-nav__link">
      Knight's tours
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/MaximumFlow/" title="Maximum flow" class="md-nav__link">
      Maximum flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/MinimumCut/" title="Minimum cut" class="md-nav__link">
      Minimum cut
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/FordFulkerson/" title="Ford-Fulkerson" class="md-nav__link">
      Ford-Fulkerson
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/DisjointPaths/" title="Disjoint Paths" class="md-nav__link">
      Disjoint Paths
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/MaximumMatchings/" title="Maximum Matchings" class="md-nav__link">
      Maximum Matchings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/KonigsTheorem/" title="Konig's Theorem" class="md-nav__link">
      Konig's Theorem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/PathCovers/" title="Path Covers" class="md-nav__link">
      Path Covers
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      DFS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        DFS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/DFS/Preface/" title="Preface" class="md-nav__link">
      Preface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/DFS/Tree/" title="DFSTree" class="md-nav__link">
      DFSTree
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/DFS/StartingFinishingTime/" title="StartingFinishingTime" class="md-nav__link">
      StartingFinishingTime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Graph/DFS/FindingCutEdges/" title="FindingCutEdges" class="md-nav__link">
      FindingCutEdges
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3" checked>
    
    <label class="md-nav__link" for="nav-2-3">
      Tree
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Tree
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Basics/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Traversal/" title="Traversal" class="md-nav__link">
      Traversal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DP/" title="DP" class="md-nav__link">
      DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SpanningTree/" title="SpanningTree" class="md-nav__link">
      SpanningTree
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        TreeQueries
      </label>
    
    <a href="./" title="TreeQueries" class="md-nav__link md-nav__link--active">
      TreeQueries
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#finding_ancestors" title="Finding ancestors" class="md-nav__link">
    Finding ancestors
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subtree_and_paths" title="Subtree and paths" class="md-nav__link">
    Subtree and paths
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subtree_queries" title="Subtree queries" class="md-nav__link">
    Subtree queries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation_1" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#path_queries" title="path queries" class="md-nav__link">
    path queries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation_2" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lowest_common_ancestor" title="Lowest Common Ancestor" class="md-nav__link">
    Lowest Common Ancestor
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problems" title="Problems" class="md-nav__link">
    Problems
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method_1" title="Method 1" class="md-nav__link">
    Method 1
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation_3" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method_2" title="Method 2" class="md-nav__link">
    Method 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation_4" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distance_of_nodes" title="Distance of nodes" class="md-nav__link">
    Distance of nodes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#offline_algorithms" title="Offline algorithms" class="md-nav__link">
    Offline algorithms
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#merging_data_structures" title="Merging data structures" class="md-nav__link">
    Merging data structures
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lowest_common_ancestors" title="Lowest common ancestors" class="md-nav__link">
    Lowest common ancestors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="Comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Sort
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        Sort
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Sort/InsertionSort/" title="InsertionSort" class="md-nav__link">
      InsertionSort
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Sort/BubbleSort/" title="BubbleSort" class="md-nav__link">
      BubbleSort
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Sort/HeapSort/" title="HeapSort" class="md-nav__link">
      HeapSort
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Sort/QuickSort/" title="QuickSort" class="md-nav__link">
      QuickSort
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../EuclideanAlgorithm/" title="Euclidean" class="md-nav__link">
      Euclidean
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      Linear
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        Linear
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Linear/BinarySearch/" title="BinarySearch" class="md-nav__link">
      BinarySearch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Linear/LowerAndUpperBounds/" title="Lower and Upper Bounds" class="md-nav__link">
      Lower and Upper Bounds
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-7" type="checkbox" id="nav-2-7">
    
    <label class="md-nav__link" for="nav-2-7">
      String
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-7">
        String
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../String/Preface/" title="Preface" class="md-nav__link">
      Preface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../String/StringHashing/" title="String Hashing" class="md-nav__link">
      String Hashing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../String/Trie/" title="Trie" class="md-nav__link">
      Trie
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../String/Z-Algorithm/" title="Z-Algorithm" class="md-nav__link">
      Z-Algorithm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../String/KMP-Algorithm/" title="KMP-Algorithm" class="md-nav__link">
      KMP-Algorithm
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-8" type="checkbox" id="nav-2-8">
    
    <label class="md-nav__link" for="nav-2-8">
      Range Queries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-8">
        Range Queries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../RangeQueries/Preface/" title="Preface" class="md-nav__link">
      Preface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../RangeQueries/StaticArrayQueries/" title="StaticArrayQueries" class="md-nav__link">
      StaticArrayQueries
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-9" type="checkbox" id="nav-2-9">
    
    <label class="md-nav__link" for="nav-2-9">
      Bit
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-9">
        Bit
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Bit/FastPower/" title="FastPower" class="md-nav__link">
      FastPower
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Bit/BitManipulation/" title="BitManipulation" class="md-nav__link">
      BitManipulation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      DataStructures
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        DataStructures
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Linear
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Linear
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../DataStructures/Linear/Stack/" title="Stack" class="md-nav__link">
      Stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../DataStructures/Linear/Vector/" title="Vector" class="md-nav__link">
      Vector
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../DataStructures/Linear/Heap/" title="Heap" class="md-nav__link">
      Heap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../DataStructures/Linear/LinkedList/" title="Linked List" class="md-nav__link">
      Linked List
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../DataStructures/Linear/Pair/" title="Pair" class="md-nav__link">
      Pair
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Hash Tables
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Hash Tables
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../DataStructures/HashTables/Preface/" title="Preface" class="md-nav__link">
      Preface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../DataStructures/HashTables/HashFunctions/" title="Hash Functions" class="md-nav__link">
      Hash Functions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      Trees
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        Trees
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../DataStructures/Trees/SearchTree/" title="SearchTree" class="md-nav__link">
      SearchTree
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../DataStructures/Trees/BST/" title="BST" class="md-nav__link">
      BST
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../DataStructures/Trees/RedBlackTree/" title="RedBlackTree" class="md-nav__link">
      RedBlackTree
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../DataStructures/Trees/BinaryIndexedTree/" title="Binary Indexed Tree" class="md-nav__link">
      Binary Indexed Tree
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../DataStructures/Trees/SegmentTree/" title="Segment Tree" class="md-nav__link">
      Segment Tree
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      MISC
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        MISC
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../MISC/Lemma/" title="Lemma" class="md-nav__link">
      Lemma
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Language
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Language
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Language/Preface/" title="Preface" class="md-nav__link">
      Preface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Language/Keywords/" title="Keywords" class="md-nav__link">
      Keywords
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Language/Class/" title="Class" class="md-nav__link">
      Class
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Contribute
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Contribute
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Contribute/HowToContribute/" title="HowToContribute" class="md-nav__link">
      HowToContribute
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Contribute/CodeOfConduct/" title="CodeOfConduct" class="md-nav__link">
      CodeOfConduct
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Contribute/Template/" title="Template" class="md-nav__link">
      Template
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Contribute/Emoji/" title="Emoji" class="md-nav__link">
      Emoji
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#finding_ancestors" title="Finding ancestors" class="md-nav__link">
    Finding ancestors
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subtree_and_paths" title="Subtree and paths" class="md-nav__link">
    Subtree and paths
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subtree_queries" title="Subtree queries" class="md-nav__link">
    Subtree queries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation_1" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#path_queries" title="path queries" class="md-nav__link">
    path queries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation_2" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lowest_common_ancestor" title="Lowest Common Ancestor" class="md-nav__link">
    Lowest Common Ancestor
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problems" title="Problems" class="md-nav__link">
    Problems
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method_1" title="Method 1" class="md-nav__link">
    Method 1
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation_3" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method_2" title="Method 2" class="md-nav__link">
    Method 2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation_4" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distance_of_nodes" title="Distance of nodes" class="md-nav__link">
    Distance of nodes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#offline_algorithms" title="Offline algorithms" class="md-nav__link">
    Offline algorithms
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#merging_data_structures" title="Merging data structures" class="md-nav__link">
    Merging data structures
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lowest_common_ancestors" title="Lowest common ancestors" class="md-nav__link">
    Lowest common ancestors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="Comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jchrys/icpc/edit/master/docs/Algorithms/Tree/TreeQueries.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="tree_queries">Tree Queries<a class="headerlink" href="#tree_queries" title="Permanent link">&para;</a></h1>
<ul>
<li>What is the $k$th ancester of a node?</li>
<li>What is the sum of values in the subtree of a node?</li>
<li>what is the sum of values on a path between two nodes?</li>
<li>what is the lowest common ancester of two nodes?</li>
</ul>
<h2 id="finding_ancestors">Finding ancestors<a class="headerlink" href="#finding_ancestors" title="Permanent link">&para;</a></h2>
<blockquote>
<p>The $k$th ancestor of a node $x$ in a rooted tree is the node that we will reach if we move $k$ levels up from $x$.
Let <code>ancestor(x, k)</code> denote the $k$th ancestor of node $x$.</p>
<p>an easy way to calculate any value of <code>ancestor(x, k)</code> is to perform a sequence of $k$ moves in the tree.
However, the time complexity of the method is $\Omicron(k)$, which may be slow, because tree of $n$ nodes may have chain of $n$ nodes.</p>
<p>Fortunately, using a technique similar to that used in <a href="/Algorithms/Graph/DirectedGraphs/#successor_paths">here</a>, any value of <code>ancestor(x, k)</code> can be efficiently calculated in $\Omicron(lgk)$ time after pre processing.
The idea is to precalculate all values <code>ancestor(x, k)</code> where $k\leq n$ is a power of two.</p>
<p>The preprocessing takes $\Omicron(nlgn)$ time, because $\Omicron(lgn)$ values are calculated for each node.</p>
<p>After this, any value of <code>ancestor(x, k)</code> can be calculated in $\Omicron(lgk)$ time by representing $k$ as a sum where each term is a power of two.</p>
</blockquote>
<h3 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">not</span> <span class="n">yet</span> <span class="n">added</span>
</pre></div>
</td></tr></table>

<h2 id="subtree_and_paths">Subtree and paths<a class="headerlink" href="#subtree_and_paths" title="Permanent link">&para;</a></h2>
<blockquote>
<p>A tree traveral array contains the nodes of a rooted tree in the order in which a depth-first search from the root node visit them. </p>
</blockquote>
<div class="admonition warning">
<p class="admonition-title">example will be added</p>
<p>we're working on it</p>
</div>
<h2 id="subtree_queries">Subtree queries<a class="headerlink" href="#subtree_queries" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Each subtree of a tree corresponds to a subarray of the tree traversal array such that the first element of the subarray is the root node.</p>
<p>Using this fact, we can efficiently process queries that are related to subtree of a tree.</p>
<p>for example: update the value of a node, calculate the sum of values in the subtree of a node.</p>
<p>The idea is to construct a tree traversal array that contains three values for each node: the identifier of the node, the size of the subtree, and the value of the node.</p>
<p>Using this array we can calculate the sum of the values in any subtree by first finding out the size of the subtree and then the values of the corresponding nodes.</p>
<p>To answer the queries efficiently, it suffices to store the values of the nodes in a <em>binary indexed or segment tree</em>.&lt;&lt; link will be added.</p>
<p>After this, we can both update a value and calculate the sum of values in $\Omicron(lgn)$ time.</p>
</blockquote>
<h3 id="implementation_1">Implementation<a class="headerlink" href="#implementation_1" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">not</span> <span class="n">yet</span> <span class="n">added</span>
</pre></div>
</td></tr></table>

<h2 id="path_queries">path queries<a class="headerlink" href="#path_queries" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Using a tree traversal array, we can also efficiently calculate sums of values on paths from the root node to any node of the tree.</p>
<p>Consider a problem where our task is to support the following queries:</p>
</blockquote>
<ul>
<li>
<p>change the value of a node</p>
</li>
<li>
<p>calculate the sum of values on a path from the root to node</p>
</li>
</ul>
<blockquote>
<p>We can solve this problem like before, but now each value in the last row of the array is the sum of values on a path from the root to the node.</p>
<p>When the value of a node increase by $x$, the sums of all nodes in its subtree increase by $x$.</p>
<p>Thus, to support both the operation, we should be able to increase all values in a range and retrieve a single value. 
This can be done in $\Omicron(lgn)$  using a binary indexed or segment tree.</p>
</blockquote>
<h3 id="implementation_2">Implementation<a class="headerlink" href="#implementation_2" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">not</span> <span class="n">yet</span> <span class="n">added</span>
</pre></div>
</td></tr></table>

<h2 id="lowest_common_ancestor">Lowest Common Ancestor<a class="headerlink" href="#lowest_common_ancestor" title="Permanent link">&para;</a></h2>
<blockquote>
<p>The lowest common ancestor of two nodes of a rooted tree is lowest node whose subtree contains both the nodes.
A typical problem is to efficiently process queries that ask to find the lowest common ancestor of two nodes.</p>
</blockquote>
<h3 id="problems">Problems<a class="headerlink" href="#problems" title="Permanent link">&para;</a></h3>
<ol>
<li><a href="https://www.acmicpc.net/problem/11437">LCA</a> <img align="absmiddle" alt=":star:" class="gemoji" height="20px" src="https://github.com/images/icons/emoji/unicode/2b50.png" title=":star:" width="20px" /><img align="absmiddle" alt=":star:" class="gemoji" height="20px" src="https://github.com/images/icons/emoji/unicode/2b50.png" title=":star:" width="20px" /></li>
<li><a href="https://www.acmicpc.net/problem/11438">LCA 2</a><img align="absmiddle" alt=":star:" class="gemoji" height="20px" src="https://github.com/images/icons/emoji/unicode/2b50.png" title=":star:" width="20px" /><img align="absmiddle" alt=":star:" class="gemoji" height="20px" src="https://github.com/images/icons/emoji/unicode/2b50.png" title=":star:" width="20px" /><img align="absmiddle" alt=":star:" class="gemoji" height="20px" src="https://github.com/images/icons/emoji/unicode/2b50.png" title=":star:" width="20px" /></li>
<li><a href="https://www.acmicpc.net/problem/15480">LCA와 쿼리</a><img align="absmiddle" alt=":star:" class="gemoji" height="20px" src="https://github.com/images/icons/emoji/unicode/2b50.png" title=":star:" width="20px" /><img align="absmiddle" alt=":star:" class="gemoji" height="20px" src="https://github.com/images/icons/emoji/unicode/2b50.png" title=":star:" width="20px" /><img align="absmiddle" alt=":star:" class="gemoji" height="20px" src="https://github.com/images/icons/emoji/unicode/2b50.png" title=":star:" width="20px" /></li>
</ol>
<h3 id="method_1">Method 1<a class="headerlink" href="#method_1" title="Permanent link">&para;</a></h3>
<blockquote>
<p>One way to solve the problem is to use the fact that we can efficiently find the $k$th ancestor of any node in the tree.
Using this, we can divide the problem of finding the lowest common ancestor into two parts.</p>
<p>We use two pointers that initially point to the two nodes whose lowest common ancestor we should find.
First, we move one of the pointers upwards so that both pointers point to nodes at the same level.
After this, we determine the minimum number of steps needed to move both pointers upwards so that they will point to the same node. The node to which the pointers point after this is the lowest common ancestor.</p>
<p>Since both parts of the algorithm can be performed in $\Omicron(lgn)$ time using precomputed information, we can find the lowest common ancestor of any two nodes in $\Omicron(lgn)$ time.</p>
</blockquote>
<h4 id="implementation_3">Implementation<a class="headerlink" href="#implementation_3" title="Permanent link">&para;</a></h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cm">/*</span>
<span class="cm">    n: number of nodes</span>
<span class="cm">    preprocess: O(nlgn)</span>
<span class="cm">    query: O(lgn)</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">log</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">__builtin_clz</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="k">const</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mf">2e5</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">MAXLOG</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">MAXN</span><span class="p">);</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">par</span><span class="p">(</span><span class="n">MAXN</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">MAXN</span><span class="p">,</span> <span class="mi">-1</span><span class="p">))</span> <span class="c1">// initially all -1 which represents that the node has no parent</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">depth</span><span class="p">(</span><span class="n">MAXN</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>


<span class="kt">void</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     preprocessing</span>
<span class="cm">     make sparse table</span>
<span class="cm">    */</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span>
        <span class="n">depth</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">par</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAXLOG</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">-1</span><span class="p">)</span>
            <span class="n">par</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="n">par</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">]][</span><span class="n">i</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">adj</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
        <span class="k">if</span><span class="p">(</span><span class="n">u</span> <span class="o">!=</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">dfs</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">    query implementation</span>
<span class="cm">    */</span>

    <span class="c1">// make depth[u] is always larger than or equal to depth[u];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">depth</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">depth</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
       <span class="n">swap</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="c1">// make depth[v] == depth[u]</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">MAXLOG</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">-1</span> <span class="o">&amp;&amp;</span> <span class="n">depth</span><span class="p">[</span><span class="n">par</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="n">h</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>

    <span class="c1">// if one of given node is parent of the other or given the same nodes u, v;</span>
    <span class="c1">// return one of them.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">u</span><span class="p">;</span>

    <span class="c1">// make par[u][0] and par[v][0] target the same node</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">MAXLOG</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">par</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>

    <span class="c1">// return parent node which is common ancester of givens.</span>
    <span class="k">return</span> <span class="n">par</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="method_2">Method 2<a class="headerlink" href="#method_2" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Another way to solve the problem is based on a tree traversal array<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>. 
Once again, the idea is to traverse the nodes using depth-first search.
However, we use a different tree traversal array: We add each node to th e array always the depth-first search walks through the node, and not only at the first visit.
Hence, a node that has $k$ children appears $k+1$ times in the array and there are a total $2n-1$ nodes in the array.</p>
<p>We store two values in the array: the identifier of the node and the depth of the node in the tree.</p>
<p>Now we can find the lowest common ancestor of nodes $a$ and $b$ by finding the node with $\text{minimum}$ depth between nodes $a$ and $b$ in the array</p>
<p>Thus to find the lowest common ancestor of two nodes it suffices to process [range minimum query].
Since the array is static, we can process such queries in $\Omicron(1)$ time after an $\Omicron(nlgn)$ time preprocessing.</p>
</blockquote>
<h3 id="implementation_4">Implementation<a class="headerlink" href="#implementation_4" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;bits/stdc++.h&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="kr">inline</span> <span class="kt">int</span>  <span class="n">log</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">__builtin_clz</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="k">const</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mf">5e4</span><span class="p">;</span>
<span class="kt">int</span> <span class="k">const</span> <span class="n">MAXLOG</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">MAXN</span><span class="p">);</span> <span class="c1">// cautious!!! size is doubled!</span>
<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">adj</span><span class="p">(</span><span class="n">MAXN</span><span class="p">);</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">depth</span><span class="p">(</span><span class="n">MAXN</span><span class="p">);</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">pos</span><span class="p">(</span><span class="n">MAXN</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">dp</span><span class="p">(</span><span class="n">MAXLOG</span><span class="p">);</span>


<span class="kt">void</span> <span class="nf">euler</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">depth</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">-1</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">depth</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span>
        <span class="n">pos</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">size</span><span class="p">();</span>
    <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span><span class="p">:</span> <span class="n">adj</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
        <span class="n">euler</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
        <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">build</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAXLOG</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">depth</span><span class="p">[</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">depth</span><span class="p">[</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]])</span> <span class="p">{</span>
                <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">rmq</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">lg</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="n">lg</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">depth</span><span class="p">[</span><span class="n">dp</span><span class="p">[</span><span class="n">lg</span><span class="p">][</span><span class="n">l</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">depth</span><span class="p">[</span><span class="n">dp</span><span class="p">[</span><span class="n">lg</span><span class="p">][</span><span class="n">r</span> <span class="o">-</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="p">])</span>
        <span class="k">return</span> <span class="n">dp</span><span class="p">[</span><span class="n">lg</span><span class="p">][</span><span class="n">l</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">dp</span><span class="p">[</span><span class="n">lg</span><span class="p">][</span><span class="n">r</span> <span class="o">-</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">pos</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
        <span class="n">swap</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">rmq</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="n">v</span><span class="p">]);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">n</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">u</span> <span class="o">&gt;&gt;</span> <span class="n">v</span><span class="p">;</span>
        <span class="n">u</span><span class="o">--</span><span class="p">;</span><span class="n">v</span><span class="o">--</span><span class="p">;</span>
        <span class="n">adj</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
        <span class="n">adj</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">reserve</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">root</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">euler</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
    <span class="n">build</span><span class="p">();</span>


    <span class="kt">int</span> <span class="n">m</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">m</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">m</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
        <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">u</span> <span class="o">&gt;&gt;</span> <span class="n">v</span><span class="p">;</span>
        <span class="n">u</span><span class="o">--</span><span class="p">;</span><span class="n">v</span><span class="o">--</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">query</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="distance_of_nodes">Distance of nodes<a class="headerlink" href="#distance_of_nodes" title="Permanent link">&para;</a></h3>
<blockquote>
<p>The distance between nodes $a$ and $b$ equals the length of the path from $a$ to $b$. 
It turns out that the problem of calculating the distance between nodes reduces to finding their lowest common ancestor.</p>
<p>First, we root the tree arbitrarily.
After this, the distance of nodes $a$ and $b$ can be calculated using the formula</p>
</blockquote>
<p>$$
depth(a) + depth(b) - 2 \sdot depth(c)
$$</p>
<blockquote>
<p>where $c$ is the lowest common ancestor of $a$ and $b$ and $depth(s)$ denotes the depth of node $s$</p>
</blockquote>
<h2 id="offline_algorithms">Offline algorithms<a class="headerlink" href="#offline_algorithms" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Offline algorithms.  those algorithms are given a set of queries which can be answered in any order.</p>
<p>It is often easier to design an offline algorithm compared to an online algorithm</p>
</blockquote>
<h3 id="merging_data_structures">Merging data structures<a class="headerlink" href="#merging_data_structures" title="Permanent link">&para;</a></h3>
<blockquote>
<p>One method to construct an offline algorithm is to perform depth-first tree traversal and maintain data structures in nodes.</p>
<p>At each node $s$, we create a data structure <code>d[s]</code> that is based on the data structures of the children of $s$.
Then using this data structure, all queries related to $s$ are processed.</p>
<p>As an example, consider the following problem: We are given a tree where each node has some value.</p>
<p>Our task is to process queries of the form "calculate the number of nodes with value $x$ in the subtree of node $s$".</p>
<p>In this problem, we can use map structures to answer the queries.</p>
<p>If we create such a data structure for each node, we can easily process all given queries, because we can handle all queries related to a node immediately after creating its data structure.</p>
<p>However it would be too slow to create all data structure from scratch.</p>
<p>Instead, at each node $s$, we create an initial data structure <code>d[s]</code> that only contains the values of $s$.</p>
<p>After this, we go through the children of $s$ and <code>merge d[s]</code> and all data structures <code>d[u]</code> where $u$ is a child of $s$.</p>
<p>The merging at node $s$ can be done as follows</p>
<p>We go through the children of $s$ and at each child $u$ merge <code>d[s]</code> and <code>d[u]</code>. </p>
<p>We always copy the contents from <code>d[u]</code> to <code>d[s]</code>.
However, before this, we <code>swap</code> the contents of <code>d[s]</code> and <code>d[u]</code> if <code>d[s]</code> is smaller than <code>d[u]</code>.
By doing this, each value is copied only $\Omicron(lgn)$ times during the tree traversal, which ensures that the algorithm is efficient.</p>
<p>To swap the contents of two data structres $a$ and $b$ efficiently, we can just use following code:</p>
</blockquote>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>It is guaranteed that the above code works in constant time when $a$ and $b$ are C++ standard library data structures.</p>
</blockquote>
<h3 id="lowest_common_ancestors">Lowest common ancestors<a class="headerlink" href="#lowest_common_ancestors" title="Permanent link">&para;</a></h3>
<blockquote>
<p>There is also an offline algorithm for processing a set of lowest common ancestor queries.</p>
<p>The algorithm is based on the <a href="">union-find data structure</a>, and the benefit of the algorithm is that it is easier to implement than the algorithm we discussed earlier.</p>
<p>The algorithm is given as input a set of pairs of nodes, and it determines for each such pair the lowest common ancestor of the nodes.</p>
<p>The algorithm performs a depth-first tree traversal and maintains disjoint sets of nodes.</p>
<p>Initially, each node belongs to a separate set.
For each set, we also store the highest node in the tree that belongs to the set.</p>
<p>When the algorithm visits a node $x$, it goes through all nodes $y$ such that the lowest common ancestor of $x$ and $y$ has to be found.
If $y$ has already been visited, the algorithm reports that the lowest common ancestor of $x$ and $y$ is the highest node in the set of $y$.</p>
<p>Then, after processing node $x$, the algorithm joins the sets of $x$ and its parent.</p>
</blockquote>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>This technique is sometimes called the Euler tour technique.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
              
              
                


  <h2 id="__comments">Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "https://icpc.ninja/Algorithms/Tree/TreeQueries/";
      this.page.identifier =
        "/Algorithms/Tree/TreeQueries/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//icpcninja.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../SpanningTree/" title="SpanningTree" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                SpanningTree
              </span>
            </div>
          </a>
        
        
          <a href="../../Sort/InsertionSort/" title="InsertionSort" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                InsertionSort
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            jchrys &copy;2019~
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="../../../js/katex.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>